<rules
  xmlns="http://namespaces.plone.org/diazo"
  xmlns:css="http://namespaces.plone.org/diazo/css"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <theme href="theme.html" />

  <!--do not theme ajax requests-->
  <xi:include href="../../../adhocracy.wordpressbasic_theme/adhocracy/wordpressbasic_theme/rules_notheme.xml" />

  <rules if-content="/html/body/div[@id='main']">

    <!-- Head: meta -->
    <drop theme="/html/head/meta" if-content="/html/head/meta"/>
    <prepend theme="/html/head" content="/html/head/meta" />
    <!-- Head: title -->
    <xi:include href="../../../adhocracy.wordpressbasic_theme/adhocracy/wordpressbasic_theme/rules_header.xml" />
    <!-- Head: base tag -->
    <replace theme="/html/head/base" content="/html/head/base" />
    <!-- Head: styles and scripts-->
    <drop theme="/html/head/link[not(contains(@href, 'style_custom.css')) and contains(@rel, 'stylesheet')]" if-content="/html/head/link"/>
    <before theme="/html/head/link[1]" content="/html/head/link[contains(@rel, 'stylesheet')]" />
    <drop theme="/html/head/script" if-content="/html/head/script"/>
    <append theme="/html/head" content="/html/head/script" />
    <append theme="/html/head" content="/html/head/style" />
    <!--Conditional comments-->
    <append theme="/html/head">
      <xsl:for-each select="/html/head/comment()">
        <xsl:copy />
      </xsl:for-each>
    </append>

    <!--Fix wordpress links -->
    <xi:include href="../../../adhocracy.wordpressbasic_theme/adhocracy/wordpressbasic_theme/rules_fixlinks.xml" />
    <replace content="//a[@class='staticlink_imprint']/attribute::href" ><xsl:attribute name="href">/_pages/imprint</xsl:attribute></replace>

    <!--Body-->
    <replace theme="/html/body" content="/html/body" />

    <!--Logo-->
      <!-- if body.compact -->
      <replace content="//a[@id='logo']/img/attribute::src" if-content="//body[contains(@class, 'compact')]"><xsl:attribute name="src">/static_theme/static/images/offene_kommune_logo_small.png</xsl:attribute></replace>
      <!-- if not body.compact -->
      <replace content="//a[@id='logo']/img/attribute::src" if-content="not(//body[contains(@class, 'compact')])"><xsl:attribute name="src">/static_theme/static/images/offene_kommune_logo_large.png</xsl:attribute></replace>

    <!--Navigation - about menu-->
    <replace css:content="li#nav_about">
      <li id="about_menu" class="">
            <a href="/_pages/das_projekt" class="" rel="" title="Das Projekt" id="about_menu_link">Das Projekt</a>
            <ul class="children">
              <li class="page_item page-item-1316">
                <a href="/_pages/das_projekt/uber-offenekommune-de" title="Über OffeneKommune.de">Über OffeneKommune.de</a>
              </li>
              <li class="page_item page-item-1322">
                  <a href="/_pages/das_projekt/offiziell-nutzen/" title="Offizielle Nutzung">Offizielle Nutzung</a>
              </li>
              <li class="page_item page-item-1323">
                  <a href="/_pages/das_projekt/offiziell-nutzen/offizielle-nutzer/" title="Offizielle Nutzer">Offizielle Nutzer</a>
              </li>
              <li class="page_item page-item-1324">
                  <a href="/_pages/das_projekt/partner_projekte/" title="Partnerprojekte">Partnerprojekte</a>
              </li>
              <li class="page_item page-item-1326">
                <a href="/_pages/das_projekt/kontakt" title="Kontakt">Kontakt</a>
              </li>
            </ul>
       </li>
    </replace>
    <!--TODO: This is not DRY joka-->
    <rules if-path="/_pages/das_projekt">
     <replace css:content="li#nav_about">
      <li class="current">
            <a href="/_pages/das_projekt" class="" rel="" title="Das Projekt" id="about_menu_link">Das Projekt</a>
            <ul class="children">
              <li class="page_item page-item-1316">
                <a href="/_pages/das_projekt/uber-offenekommune-de" title="Über OffeneKommune.de">Über OffeneKommune.de</a>
              </li>
              <li class="page_item page-item-1322">
                  <a href="/_pages/das_projekt/offiziell-nutzen/" title="Offizielle Nutzung">Offizielle Nutzung</a>
              </li>
              <li class="page_item page-item-1323">
                  <a href="/_pages/das_projekt/offiziell-nutzen/offizielle-nutzer/" title="Offizielle Nutzer">Offizielle Nutzer</a>
              </li>
              <li class="page_item page-item-1324">
                  <a href="/_pages/das_projekt/partner_projekte/" title="Partnerprojekte">Partnerprojekte</a>
              </li>
              <li class="page_item page-item-1326">
                <a href="/_pages/das_projekt/kontakt" title="Kontakt">Kontakt</a>
              </li>
            </ul>
      </li>
     </replace>
     <replace content="//li[@id='nav_home']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
    </rules>

    <!--Navigation - engagieren-->
    <replace css:content="li#nav_dummy">
      <li>
        <a href="/_pages/weiterentwicklung" title="Weiterentwicklung">Weiterentwicklung</a>
        <ul class="children">
            <li class="page_item page-item-1333">
              <a href="/_pages/weiterentwicklung/open_source" title="Open Source">Open Source</a>
            </li>
            <li class="page_item page-item-1334">
                <a href="https://feedback.offenekommune.de/instance/feedback" title="Feedback">Feedback</a>
            </li>
            <li class="page_item page-item-1335">
                <a href="https://github.com/liqd/adhocracy" title="GitHub">GitHub</a>
            </li>
            <li class="page_item page-item-1337">
              <a href="/_pages/unterstutzung/mitarbeiten_und_helfen/" title="Mitarbeiten und Helfen">Mitarbeiten und Helfen</a>
            </li>
            <li class="page_item page-item-1338">
              <a href="/_pages/unterstutzung/spenden/" title="Spenden und Fördern">Spenden und Fördern</a>
            </li>
         </ul>
      </li>
    </replace>
    <rules if-path="/_pages/weiterentwicklung">
     <replace css:content="li#nav_dummy">
        <li class="current">
        <a href="/_pages/weiterentwicklung" title="Weiterentwicklung">Weiterentwicklung</a>
        <ul class="children">
            <li class="page_item page-item-1333">
              <a href="/_pages/weiterentwicklung/open_source" title="Open Source">Open Source</a>
            </li>
            <li class="page_item page-item-1334">
                <a href="https://feedback.offenekommune.de/instance/feedback" title="Feedback">Feedback</a>
            </li>
            <li class="page_item page-item-1335">
                <a href="https://github.com/liqd/adhocracy" title="GitHub">GitHub</a>
            </li>
            <li class="page_item page-item-1337">
              <a href="/_pages/unterstutzung/mitarbeiten_und_helfen/" title="Mitarbeiten und Helfen">Mitarbeiten und Helfen</a>
            </li>
            <li class="page_item page-item-1338">
              <a href="/_pages/unterstutzung/spenden/" title="Spenden und Fördern">Spenden und Fördern</a>
            </li>
         </ul>
        </li>
     </replace>
     <replace content="//li[@id='nav_help']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
     <replace content="//li[@id='nav_home']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
     <replace content="//li[@id='nav_instances']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
    </rules>

    <!--Navigation - help-->
    <replace css:content="li#nav_help">
      <li class="" id="nav_help">
        <a href="/_pages/unterstutzung" title="">Support</a>
        <ul class="children">
          <li class="page_item page-item-1332">
            <a href="/_pages/unterstutzung/anleitungen/" title="Anleitungen">Anleitungen</a>
          </li>
          <li class="page_item page-item-1333">
              <a href="/_pages/unterstutzung/anleitungen/formatierungshilfe/" title="Formatierungshilfe">Formatierungshilfe</a>
          </li>
          <li class="page_item page-item-1334">
            <a href="/_pages/unterstutzung/faq/" title="FAQs">FAQs</a>
          </li>
          <li class="page_item page-item-1335">
              <a href="/_pages/unterstutzung/technischer_support/" title="Technischer Support">Technischer Support</a>
          </li>
          <li class="page_item page-item-1336">
              <a href="/_pages/unterstutzung/schulungen_und_vortraege/" title="Schulungen und Vorträge">Schulungen und Vorträge</a>
          </li>
          <li class="page_item page-item-1337">
              <a href="/_pages/unterstutzung/mitarbeiten_und_helfen/" title="Mitarbeiten und Helfen">Mitarbeiten und Helfen</a>
          </li>
          <li class="page_item page-item-1338">
              <a href="/_pages/unterstutzung/spenden/" title="Spenden und Fördern">Spenden und Fördern</a>
          </li>
          <li class="page_item page-item-1339">
              <a href="/_pages/unterstutzung/materialien/" title="Materialien">Materialien</a>
          </li>
        </ul>
      </li>
    </replace>
    <rules if-path="/_pages/unterstutzung">
     <replace css:content="li#nav_help">
        <li class="current" id="nav_help">
        <a href="/_pages/unterstutzung" title="">Support</a>
        <ul class="children">
          <li class="page_item page-item-1332">
            <a href="/_pages/unterstutzung/anleitungen/" title="Anleitungen">Anleitungen</a>
          </li>
          <li class="page_item page-item-1333">
              <a href="/_pages/unterstutzung/anleitungen/formatierungshilfe/" title="Formatierungshilfe">Formatierungshilfe</a>
          </li>
          <li class="page_item page-item-1334">
            <a href="/_pages/unterstutzung/faq/" title="FAQs">FAQs</a>
          </li>
          <li class="page_item page-item-1335">
              <a href="/_pages/unterstutzung/technischer_support/" title="Technischer Support">Technischer Support</a>
          </li>
          <li class="page_item page-item-1336">
              <a href="/_pages/unterstutzung/schulungen_und_vortraege/" title="Schulungen und Vorträge">Schulungen und Vorträge</a>
          </li>
          <li class="page_item page-item-1337">
              <a href="/_pages/unterstutzung/mitarbeiten_und_helfen/" title="Mitarbeiten und Helfen">Mitarbeiten und Helfen</a>
          </li>
          <li class="page_item page-item-1338">
              <a href="/_pages/unterstutzung/spenden/" title="Spenden und Fördern">Spenden und Fördern</a>
          </li>
          <li class="page_item page-item-1339">
              <a href="/_pages/unterstutzung/materialien/" title="Materialien">Materialien</a>
          </li>
        </ul>
        </li>
     </replace>
     <replace content="//li[@id='nav_home']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
     <replace content="//li[@id='nav_instances']/attribute::class"><xsl:attribute name="class"></xsl:attribute></replace>
    </rules>

    <!-- Not using wordpressbasic_theme, as we're pulling different stuff in here -->
    <rules if-content="//div[@id='content-startpage']">
    <!--WARNING: throws error if the wordpress backend is not available-->
    <!--Merge wordpress content section-->
    <replace css:content-children="div#content-startpage" if="not($wordpress_backend = '')" >
      <xsl:variable name="url_startpage" select="concat('http://', $wordpress_backend_startseite)"/>
      <xsl:copy-of select="document($url_startpage)//*[contains(@id, 'startpage-wordpress-topleft')]/*"/>
       <p><xsl:text disable-output-escaping="yes">&amp;nbsp;</xsl:text></p>
    </replace>
    </rules>

    <rules if-content="//div[@id='content-bottom-left']">
    <!--WARNING: throws error if the wordpress backend is not available-->
    <!--Merge wordpress content section-->
    <replace css:content-children="div#content-bottom-left" if="not($wordpress_backend = '')" >
      <xsl:variable name="url_startpage" select="concat('http://', $wordpress_backend_startseite)"/>
      <xsl:copy-of select="document($url_startpage)//*[contains(@id, 'startpage-wordpress-bottom-left')]/*"/>
       <p><xsl:text disable-output-escaping="yes">&amp;nbsp;</xsl:text></p>
    </replace>
    </rules>

    <rules if-content="//div[@id='content-bottom-center']">
    <!--WARNING: throws error if the wordpress backend is not available-->
    <!--Merge wordpress content section-->
    <replace css:content-children="div#content-bottom-center" if="not($wordpress_backend = '')" >
      <xsl:variable name="url_startpage" select="concat('http://', $wordpress_backend_startseite)"/>
      <xsl:copy-of select="document($url_startpage)//*[contains(@id, 'startpage-wordpress-bottom-center')]/*"/>
       <p><xsl:text disable-output-escaping="yes">&amp;nbsp;</xsl:text></p>
    </replace>
    </rules>

    <rules if-content="//div[@id='content-bottom-right']">
    <!--WARNING: throws error if the wordpress backend is not available-->
    <!--Merge wordpress content section-->
    <replace css:content-children="div#content-bottom-right" if="not($wordpress_backend = '')" >
      <xsl:variable name="url_startpage" select="concat('http://', $wordpress_backend_startseite)"/>
      <xsl:copy-of select="document($url_startpage)//*[contains(@id, 'startpage-wordpress-bottom-right')]/*"/>
       <p><xsl:text disable-output-escaping="yes">&amp;nbsp;</xsl:text></p>
    </replace>
    </rules>

    <!--Content body and sidebar: aboutpage with merged wordpress-->
    <rules if-path="/_pages/mehr-erfahren">
      <replace content="//div[@id='main']/attribute::class" ><xsl:attribute name="class">with_wordpress_tabs</xsl:attribute></replace>
      <drop css:content="#col1" attributes="id" />
      <drop css:content="#col3" />
    </rules>

    <!--Content body and sidebar: wordpress pages (/_pages)-->
    <xi:include href="../../../adhocracy.wordpressbasic_theme/adhocracy/wordpressbasic_theme/rules_pages.xml" />
    <xi:include href="rules_wordpress_javascript.xml" />

  </rules>
</rules>
